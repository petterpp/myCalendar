<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html" >
        <h:head>
            <f:facet name="first">
                <title>Mine Kalendar</title>
            </f:facet>
            <link type="text/css" rel="stylesheet" href="/project/faces/javax.faces.resource/theme.css?ln=primefaces-cupertino" />
            <link rel="stylesheet" type="text/css" href="../cupertino.css" />
            <link rel="stylesheet" type="text/css" href="../CSS/schedule.css" />

            <script type="text/javascript">  
                function handleLoginRequest(xhr, status, args) {  
                    if(args.validationFailed || !args.loggedIn) {  
                        jQuery('#form .ui-dialog').effect("shake", { times:3 }, 100);
                    } else {  
                        jQuery('#form .ui-tree').effect("", { time:1}, 100);
                        dlg.hide();  
                    }  
                }  
            </script>
        </h:head>

        <h:body>
            <h:form id="form">
                <p:growl id="growl" showDetail="true" />

                <p:layout fullPage="true">

                    <p:layoutUnit position="north" size="100" resizable="true" closable="true" collapsible="true">
                        <h1>Mine Kalendar</h1>
                    </p:layoutUnit>

                    <!--Left Panel-->
                    <p:layoutUnit position="west" size="225" header="Left" collapsible="true" resizable="true">
                        <!--Calendar-->
                        <p:calendar value="#{CalendarBean.date1}" mode="inline" id="inlineCal"  style="display: block;" />

                        <!--Task Tree Panel-->
                        <p:panel id="categoryPanel" header="Categories" >
                            <p:tree id="docTree" value="#{taskTreeBean.root}" var="task" 
                                    cache="true" selectionMode="single"  dynamic="true"
                                    selection="#{taskTreeBean.selectedNode}">  

                                <p:ajax event="expand" update=":form:growl" listener="#{taskTreeBean.onNodeExpand}" />  
                                <p:ajax event="collapse" update=":form:growl" listener="#{taskTreeBean.onNodeCollapse}" />  
                                <p:ajax event="select" update=":form:growl" listener="#{taskTreeBean.onNodeSelect}" />  
                                <p:ajax event="unselect" update=":form:growl" listener="#{taskTreeBean.onNodeUnselect}" />

                                <p:treeNode type="category">
                                    <h:outputText value="#{task}"/>
                                </p:treeNode>

                                <p:treeNode type="project" icon="ui-icon-document">
                                    <h:outputText value="#{task}" />  
                                </p:treeNode>  

                                <p:treeNode type="task" icon="ui-icon-image">  
                                    <h:outputText value="#{task}" />  
                                </p:treeNode>

                                <p:treeNode type="new" >
                                    <p:commandButton id ="newCategory" value="#{task}" 
                                                        actionListener="#{taskTreeBean.regNewCategory}" 
                                                        oncomplete="dlg.show()" />
                                </p:treeNode>
                            </p:tree>
                        </p:panel>
                    </p:layoutUnit>

                    <!--Center Panel-->
                    <p:layoutUnit position="center" resizable="true" >
                        <ui:include src="/pages/schedule.xhtml" />
                    </p:layoutUnit>
                </p:layout>

                <!--Register New Item Dialog-->
                <p:dialog id="ajaxDlg" header="New Category Register Dialog" widgetVar="dlg" dynamic="true" 
                          resizable="false" width="415" style="font-size: 1em;">  

                        <h:panelGrid columns="2" cellpadding="5">  
                            <h:outputLabel for="lblRegName" value="New Name : *" />  
                            <p:inputText value="#{taskTreeBean.regName}" 
                                    id="lblRegName" required="true" label="Register Name" />

                            <f:facet name="footer">  
                                <p:commandButton id="regButton" value="Save" update=":form:growl, :form:docTree"   
                                    actionListener="#{taskTreeBean.categoryReg}" 
                                    oncomplete="handleLoginRequest(xhr, status, args)" style="font-size: 1em;">
                                </p:commandButton>
                            </f:facet>  
                        </h:panelGrid>  

                </p:dialog>
            </h:form>
        </h:body>
    </f:view>
</html>